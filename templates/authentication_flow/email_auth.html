{% extends "base.html" %}
{% block content %}
<h1>Sign in with your email</h1>
<section>
    <form method="POST" action="{{ url_for('callbacks.email_auth') }}">
      {% if representative_h_card %}
      <section class="profile-card">
         <img src="{{ representative_h_card["photo"] }}" alt="Profile photo for {{ name }}" height="100" width="100" />
         <p>{{ representative_h_card["name"] }} (<a href="{{ session.get("rel_me_check") }}">{{ session.get("rel_me_check") }}</a>)</p>
      </section>
      {% endif %}
      <p>To sign in as <code>{{ session.get("rel_me_check") }}</code>, enter the verification code sent to your email address.</p>
      {{ email_verification_form.csrf_token }}
      {{ email_verification_form.code.label }} {{ email_verification_form.code() }}<br>
      {{ email_verification_form.submit() }}
      <small>If you did not receive an email, <a href="{{ url_for('callbacks.email_auth') }}?no_resend=false">click here</a> to send another email.</small>
    </form>
</section>
<script>
  /* add https:// to URL fields on blur or when enter is pressed */
  document.addEventListener('DOMContentLoaded', function() {
    function addDefaultScheme(target) {
      if(target.value.match(/^(?!https?:).+\..+/)) {
        target.value = "https://"+target.value;
      }
    }
    var elements = document.querySelectorAll("input[type=url]");
    Array.prototype.forEach.call(elements, function(el, i){
      el.addEventListener("blur", function(e){
        addDefaultScheme(e.target);
      });
      el.addEventListener("keydown", function(e){
        if(e.keyCode == 13) {
          addDefaultScheme(e.target);
        }
      });
    });
  });

</script>
{% endblock %}