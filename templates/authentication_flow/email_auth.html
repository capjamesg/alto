{% extends "base.html" %}
{% block content %}
<h1>Sign in with your email</h1>
<section>
    {% with messages = get_flashed_messages() %}
       {% if messages %}
          <ul class="message">
          {% for message in messages %}
             <li>{{ message }}</li>
          {% endfor %}
          </ul>
       {% endif %}
    {% endwith %}
    <form method="POST" action="{{ url_for('callbacks.email_auth') }}">
        <p>To log in, please provide the code sent to your email.</p>
        {{ email_verification_form.csrf_token }}
        {{ email_verification_form.code.label }} {{ email_verification_form.code() }}<br>
        {{ email_verification_form.submit() }}
    </form>
</section>
<script>
  /* add https:// to URL fields on blur or when enter is pressed */
  document.addEventListener('DOMContentLoaded', function() {
    function addDefaultScheme(target) {
      if(target.value.match(/^(?!https?:).+\..+/)) {
        target.value = "https://"+target.value;
      }
    }
    var elements = document.querySelectorAll("input[type=url]");
    Array.prototype.forEach.call(elements, function(el, i){
      el.addEventListener("blur", function(e){
        addDefaultScheme(e.target);
      });
      el.addEventListener("keydown", function(e){
        if(e.keyCode == 13) {
          addDefaultScheme(e.target);
        }
      });
    });
  });

</script>
{% endblock %}